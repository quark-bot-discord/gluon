<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>managers/ChannelMessageManager.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Attachment.html">Attachment</a></li><li><a href="AuditLog.html">AuditLog</a><ul class='methods'><li data-type='method'><a href="AuditLog.html#toJSON">toJSON</a></li></ul></li><li><a href="ButtonClick.html">ButtonClick</a></li><li><a href="Channel.html">Channel</a><ul class='methods'><li data-type='method'><a href="Channel.html#send">send</a></li></ul></li><li><a href="ChannelMessageManager.html">ChannelMessageManager</a><ul class='methods'><li data-type='method'><a href="ChannelMessageManager.html#fetch">fetch</a></li><li data-type='method'><a href="ChannelMessageManager.html#fetchPinned">fetchPinned</a></li><li data-type='method'><a href="ChannelMessageManager.html#sweepMessages">sweepMessages</a></li></ul></li><li><a href="Client.html">Client</a><ul class='methods'><li data-type='method'><a href="Client.html#createWebhook">createWebhook</a></li><li data-type='method'><a href="Client.html#deleteChannelMessage">deleteChannelMessage</a></li><li data-type='method'><a href="Client.html#deleteWebhook">deleteWebhook</a></li><li data-type='method'><a href="Client.html#editMessage">editMessage</a></li><li data-type='method'><a href="Client.html#fetchChannelMessages">fetchChannelMessages</a></li><li data-type='method'><a href="Client.html#fetchChannelWebhooks">fetchChannelWebhooks</a></li><li data-type='method'><a href="Client.html#fetchMessage">fetchMessage</a></li><li data-type='method'><a href="Client.html#followStatusChannel">followStatusChannel</a></li><li data-type='method'><a href="Client.html#login">login</a></li><li data-type='method'><a href="Client.html#modifyWebhook">modifyWebhook</a></li><li data-type='method'><a href="Client.html#postWebhook">postWebhook</a></li><li data-type='method'><a href="Client.html#purgeChannelMessages">purgeChannelMessages</a></li><li data-type='method'><a href="Client.html#sendMessage">sendMessage</a></li><li data-type='method'><a href="Client.html#setStatus">setStatus</a></li></ul></li><li><a href="Emoji.html">Emoji</a></li><li><a href="Guild.html">Guild</a><ul class='methods'><li data-type='method'><a href="Guild.html#ban">ban</a></li><li data-type='method'><a href="Guild.html#calculateMemberCacheCount">calculateMemberCacheCount</a></li><li data-type='method'><a href="Guild.html#calculateMessageCacheCount">calculateMessageCacheCount</a></li><li data-type='method'><a href="Guild.html#fetchAuditLogs">fetchAuditLogs</a></li><li data-type='method'><a href="Guild.html#fetchBan">fetchBan</a></li><li data-type='method'><a href="Guild.html#fetchChannels">fetchChannels</a></li><li data-type='method'><a href="Guild.html#fetchInvites">fetchInvites</a></li><li data-type='method'><a href="Guild.html#kick">kick</a></li><li data-type='method'><a href="Guild.html#leave">leave</a></li><li data-type='method'><a href="Guild.html#me">me</a></li><li data-type='method'><a href="Guild.html#removeMemberRole">removeMemberRole</a></li><li data-type='method'><a href="Guild.html#unban">unban</a></li></ul></li><li><a href="GuildChannelsManager.html">GuildChannelsManager</a><ul class='methods'><li data-type='method'><a href="GuildChannelsManager.html#fetch">fetch</a></li></ul></li><li><a href="GuildEmojisManager.html">GuildEmojisManager</a><ul class='methods'><li data-type='method'><a href="GuildEmojisManager.html#fetch">fetch</a></li></ul></li><li><a href="GuildManager.html">GuildManager</a></li><li><a href="GuildMemberManager.html">GuildMemberManager</a><ul class='methods'><li data-type='method'><a href="GuildMemberManager.html#fetch">fetch</a></li><li data-type='method'><a href="GuildMemberManager.html#search">search</a></li><li data-type='method'><a href="GuildMemberManager.html#sweepMembers">sweepMembers</a></li></ul></li><li><a href="GuildRoleManager.html">GuildRoleManager</a><ul class='methods'><li data-type='method'><a href="GuildRoleManager.html#fetch">fetch</a></li></ul></li><li><a href="GuildVoiceStatesManager.html">GuildVoiceStatesManager</a></li><li><a href="Interaction.html">Interaction</a><ul class='methods'><li data-type='method'><a href="Interaction.html#acknowledge">acknowledge</a></li><li data-type='method'><a href="Interaction.html#edit">edit</a></li><li data-type='method'><a href="Interaction.html#reply">reply</a></li></ul></li><li><a href="Message.html">Message</a><ul class='methods'><li data-type='method'><a href="Message.html#edit">edit</a></li><li data-type='method'><a href="Message.html#reply">reply</a></li><li data-type='method'><a href="Message.html#shelf">shelf</a></li></ul></li><li><a href="MessagePollManager.html">MessagePollManager</a><ul class='methods'><li data-type='method'><a href="MessagePollManager.html#addVote">addVote</a></li><li data-type='method'><a href="MessagePollManager.html#removeVote">removeVote</a></li></ul></li><li><a href="ScheduledEvent.html">ScheduledEvent</a></li><li><a href="SlashCommand.html">SlashCommand</a></li><li><a href="Sticker.html">Sticker</a></li><li><a href="TextChannel.html">TextChannel</a><ul class='methods'><li data-type='method'><a href="TextChannel.html#bulkDelete">bulkDelete</a></li><li data-type='method'><a href="TextChannel.html#send">send</a></li></ul></li><li><a href="Thread.html">Thread</a><ul class='methods'><li data-type='method'><a href="Thread.html#send">send</a></li></ul></li><li><a href="User.html">User</a></li><li><a href="UserManager.html">UserManager</a><ul class='methods'><li data-type='method'><a href="UserManager.html#fetch">fetch</a></li><li data-type='method'><a href="UserManager.html#sweepUsers">sweepUsers</a></li></ul></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">managers/ChannelMessageManager.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const Client = require("../Client");
const Channel = require("../structures/Channel");
const Message = require("../structures/Message");

/**
 * Manages all messages within a channel.
 */
class ChannelMessageManager {

    /**
     * Creates a channel message manager.
     * @param {Client} client The client instance.
     * @param {Channel} channel The channel that is being managed.
     */
    constructor(client, channel) {

        this.client = client;

        this.channel = channel;

        this.cache = new Map();

    }

    /**
     * Fetches a collection of messages or a singular message from the channel.
     * @param {Object | String | BigInt} options Either an object of {@link https://discord.com/developers/docs/resources/channel#get-channel-messages-query-string-params|options} or a message id.
     * @returns {Promise&lt;Array&lt;Message>> | Promise&lt;Message>}
     */
    async fetch(options) {

        if (typeof options == "object") {

            if (this.cache.size != 0) {
                let cachedMessages = [];
                this.cache.forEach((key, value) => {
                    if (options.before &amp;&amp; value.id &lt; options.before)
                        cachedMessages.push(value);
                });
            }

            const body = {};

            if (options.around)
                body.around = options.around;

            if (options.before)
                body.before = options.before;

            if (options.after)
                body.after = options.after;

            if (options.limit)
                body.limit = options.limit;

            const data = await this.client.request.makeRequest("getChannelMessages", [this.channel.id], body);
            let messages = [];
            for (let i = 0; i &lt; data.length; i++)
                messages.push(new Message(this.client, data[i], data[i].channel_id, this.channel.guild.id.toString()));
            return messages;

        } else if (typeof options == "string" || typeof options == "bigint") {

            const cachedMessage = this.cache.get(options);
            if (cachedMessage)
                return cachedMessage;

            const data = await this.client.request.makeRequest("getChannelMessage", [this.channel.id, options]);

            return new Message(this.client, data, this.channel.id.toString(), this.channel.guild.id.toString());

        }

    }

    /**
     * Fetches all the pinned messages that belong to the channel.
     * @returns {Promise&lt;Array&lt;Message>>}
     */
    async fetchPinned() {

        const data = await this.client.request.makeRequest("getPinned", [this.channel.id]);

        let messages = [];
        for (let i = 0; i &lt; data.length; i++)
            messages.push(new Message(this.client, data[i], data[i].channel_id, this.channel.guild.id.toString()));
        return messages;

    }

    /**
     * Sweeps messages from the channel which have been flagged for deletion, or moves messages to local storage if the guild has increased cache limits.
     * @param {Number} cacheCount The maximum number of messages that may be stored for this channel, or 0 for no limit.
     * @param {Number} currentTime The current UNIX time.
     * @returns {Number} The remaining number of messages in the channel.
     */
    sweepMessages(cacheCount, currentTime) {

        if (this.cache.size == 0)
            return;

        const currentCacheSize = this.cache.size;
        const currentCacheKeys = this.cache.keys();
        const currentCacheValues = this.cache.values();

        for (let i = 0, cacheSize = currentCacheSize; i &lt; currentCacheSize; i++) {
            const currentCacheValue = currentCacheValues.next().value;
            if (currentCacheValue)
                if ((currentCacheValue.timestamp + this.client.defaultMessageExpiry &lt; currentTime) || (cacheCount != 0 ? cacheSize > cacheCount : false)) {
                    if (this.client.increasedCache.get(this.channel.guild_id?.toString() || this.channel.guild.id.toString()))
                        currentCacheValue.shelf();
                    else {
                        this.cache.delete(currentCacheKeys.next().value);
                        cacheSize--;
                    }
                }
        }

        return this.cache.size;

    }

}

module.exports = ChannelMessageManager;</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Wed May 08 2024 19:58:08 GMT+0000 (Coordinated Universal Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
